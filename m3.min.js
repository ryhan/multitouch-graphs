/*
 * MultiTouch Multiline Models
 * Authored by Ryhan Hassan
 * rhassan@andrew.cmu.edu
 *//*******************************************************************
 * CONFIGURATION OPTIONS
 * These options must be set before m3 is intitalized,
 * or specifically passed to the m3.Graph constructor.
 *******************************************************************/// Flag for debugging mode.
var DEVELOPMENT=!0,DEFAULT_CONFIG={container:{width:600,height:400},gestureR:{width:500,height:400},xAxis:{width:700,height:100},yAxis:{width:100,height:300},SVG:{ns:"http://www.w3.org/2000/svg",xlinkns:"http://www.w3.org/1999/xlink",fill:"steelblue",stroke:"steelblue",weight:2,width:700,height:300}},warnIf=function(){},assert=function(){},typecheck=function(){};if(DEVELOPMENT){warnIf=function(e,t){var n=n||{};e&&n.warn(t)};assert=function(e,t){if(!e)throw new Error(t)};typecheck=function(e,t,n){assert(typeof e===t,"Expected "+n+" to be "+t)}}var m3=function(){var e=e||"";typecheck(e,"object","Underscore.js");var t=function(e,t){this.x=e||0;this.y=t||0;typecheck(this.x,"number","x");typecheck(this.y,"number","y");warnIf(e%1!==0,"Expects x to be time - integer ms since epoch")},n=function(e,t){this.name=e||"";this.data=t||[];warnIf(this.data.length===0,"Series contains no data points.");warnIf(this.data.length===1,"Series contains only one data point.");typecheck(this.name,"string","name");typecheck(this.data,"object","points")},r=function(e,t,n){this.name=e||"";this.data=t||[];this.config=n||DEFAULT_CONFIG;typecheck(this.name,"string","name");typecheck(this.data,"object","seriesSet");typecheck(this.config,"object","config")};t.prototype.range=function(){return{xMin:this.x,xMax:this.x,yMin:this.y,yMax:this.y}};var i=function(){typecheck(this.data,"object","Object data");warnIf(this.data.length===0,"Calling .range() on empty data.");var t=[];e.map(this.data,function(e){t.push(e.range())});var n=e.min(e.pluck(t,"xMin")),r=e.max(e.pluck(t,"xMax")),i=e.min(e.pluck(t,"yMin")),s=e.max(e.pluck(t,"yMax"));typecheck(n,"number","xmin");typecheck(r,"number","xmax");typecheck(i,"number","ymin");typecheck(s,"number","ymax");i=i>0?0:i;s=s<0?0:s;assert(n<=r,"(x) Minimum should not exceed maximum.");assert(i<=s,"(y) Minimum should not exceed maximum.");return{xMin:n,xMax:r,yMin:i,yMax:s}};n.prototype.range=i;r.prototype.range=i;r.prototype.normalize=function(){var e=this.range(),t=function(e,t,n){warnIf(t>=n,"Unexpected normalization bounds.");typecheck(t,"number","min");typecheck(n,"number","max");return function(r){typecheck(r,"number",e);r=(r-t)/(n-t);warnIf(0>r||r>1,e+" outside of expected bounds.");return r}};return{x:t("x",e.xMin,e.xMax),y:t("y",e.yMin,e.yMax)}};var s=function(e){var t=this.normalize();return{x:function(n){return t.x(n)*e.width},y:function(n){return e.height-t.y(n)*e.height}}};r.prototype.scale=s;t.prototype.toStr=function(e){typecheck(e,"object","Scale");return e.x(this.x)+" "+e.y(this.y)+" "};n.prototype.toStr=function(t){warnIf(this.data.length===0,"Calling .toStr() on empty data.");warnIf(this.data.length===1,"Calling .toStr() on single data point.");typecheck(t,"object","Scale");var n=e.sortBy(this.data,function(e){return e.x}),r=["M "+n[0].toStr(t)];e.map(n,function(e){r.push("L "+e.toStr(t))});r=r.concat(r.slice(0).reverse());return r.join(" ")+" Z"};n.prototype.render=function(e,t){typecheck(t,"object","Scale");typecheck(e,"object","SVG");var n=document.createElementNS(e.ns,"path");n.setAttribute("d",this.toStr(t));n.setAttribute("fill",e.fill);n.setAttribute("stroke",e.stroke);n.setAttribute("stroke-width",e.weight);typecheck(n,"object","path");return n};r.prototype.render=function(){typecheck(this.config.SVG,"object","config.SVG");var t=document.createElementNS(this.config.SVG.ns,"svg");t.setAttribute("xmlns",this.config.SVG.ns);t.ns=this.config.SVG.ns;t.xlinkns=this.config.SVG.xlinkns;t.style.height=this.config.SVG.height+"px";t.style.width=this.config.SVG.width+"px";var n=this.scale(this.config.SVG),r=this.config.SVG;e.map(this.data,function(e){var i=r,s=e.render(i,n);t.appendChild(s)});typecheck(t,"object","SVG");return t};var o=function(e,t,n,r){};r.prototype.timeUnit=function(){var t=this.range(),n=t.xMax-t.xMin,r=this.config.xAxis.width,i=n/r*100,s=[{factor:1,unit:"millisecond"},{factor:1e3,unit:"second"},{factor:6e4,unit:"minute"},{factor:36e5,unit:"hour"},{factor:864e5,unit:"day"},{factor:6048e5,unit:"week"},{factor:2592e6,unit:"month"},{factor:31536e6,unit:"year"},{factor:31536e7,unit:"decade"}],o=1;return s[1+e.sum(e.map(s,function(e){return i<e.factor*o?1:0}))]};var u=function(e,t){var n=document.createElement("div");n.setAttribute("class",e);n.style.height=t.height+"px";n.style.width=t.width+"px";return n};r.prototype.constructHTML=function(){var e=u("m3 m3Container",this.config.container),t=u("m3 m3GestureRegion",this.config.gestureR),n=u("m3 m3Axis m3xAxis",this.config.xAxis),r=u("m3 m3Axis m3yAxis",this.config.yAxis),i=u("m3 m3TextLabel",{height:80,width:40});i.innerHTML="December 12, 2012";i.style.left="200px";n.appendChild(i);t.appendChild(this.render());t.appendChild(n);e.appendChild(t);e.appendChild(r);return e};return{Point:t,Series:n,Graph:r}}(),seriesA=new m3.Series("A",[new m3.Point(3,4),new m3.Point(2,8),new m3.Point(5,10)]),seriesB=new m3.Series("B",[new m3.Point(1,3),new m3.Point(4,2),new m3.Point(5,8)]),g=new m3.Graph("tmp",[seriesA,seriesB]);g.constructHTML();